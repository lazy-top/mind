<!DOCTYPE html>
<html>
	<head>
		<!-- å¼•å…¥ Vue å’Œ Vuetify çš„ JS -->
		<script src="../js/vue.js"></script>
		<script src="../js/vuetify.js"></script>
		<script src="../js/socket.io.min.js"></script>
		<script src="../js/axios.min.js"></script>
		<script src="../js/vuex.global.min.js"></script>
		<!-- å¼•å…¥ Vuetify çš„ CSS -->
		<link href="../css/materialdesignicons.min.css" rel="stylesheet">
		<link href="../css/vuetify.min.css" rel="stylesheet">
		<meta name="viewport"
			content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
	</head>
	<body>
		<div id="app">
			<v-dialog v-model="settingsDialog" max-width="500">
				<v-card>
					<v-card-title class="headline">è®¾ç½®</v-card-title>

					<v-card-text>
						<!-- è®¾ç½®å†…å®¹ -->
						<v-text-field label="ç”¨æˆ·å" v-model="username"></v-text-field>
						<v-text-field label="é‚®ç®±" v-model="email"></v-text-field>
					</v-card-text>

					<v-card-actions>
						<v-spacer></v-spacer>
						<v-btn color="primary" @click="saveSettings">ä¿å­˜</v-btn>
						<v-btn @click="closeSettingsDialog">å–æ¶ˆ</v-btn>
					</v-card-actions>
				</v-card>
			</v-dialog>
			<v-snackbar v-model="showToast" :timeout="1000" color="orange" :top="true" style="text-align: center;">
				{{ errorMessage }}
			</v-snackbar>
			<v-dialog v-model="loginDialog" max-width="500" persistent>
				<v-card>
					<v-tabs v-model="tab">
						<v-tab>ç™»å½•</v-tab>
						<v-tab>æ³¨å†Œ</v-tab>
					</v-tabs>

					<v-tabs-items v-model="tab">
						<v-tab-item>
							<v-card-text>
								<v-text-field label="ç”¨æˆ·å" v-model="username" outlined maxlength="20"
									placeholder="è¯·è¾“å…¥ç”¨æˆ·å" clearable prepend-inner-icon="mdi-account"></v-text-field>
								<v-text-field label="å¯†ç " type="password" v-model="password" outlined maxlength="20"
									placeholder="è¯·è¾“å…¥å¯†ç " clearable prepend-inner-icon="mdi-lock"></v-text-field>

							</v-card-text>
							<v-card-actions>
								<v-btn color="primary" @click="login" block>ç™»å½•</v-btn>
							</v-card-actions>
						</v-tab-item>

						<v-tab-item>
							<v-card-text>
								<!-- æ·»åŠ æ³¨å†Œè¡¨å•çš„å†…å®¹ -->
								<v-text-field label="ç”¨æˆ·å" v-model="newUsername" outlined outlined maxlength="20"
									placeholder="è¯·è¾“å…¥ç”¨æˆ·å" prepend-inner-icon="mdi-account"></v-text-field>
								<v-text-field label="é‚®ç®±" v-model="newEmail" outlined outlined maxlength="50"
									placeholder="è¯·è¾“å…¥é‚®ç®±" prepend-inner-icon="mdi-email"></v-text-field>
								<v-text-field label="å¯†ç " type="password" v-model="newPassword" outlined maxlength="20"
									placeholder="è¯·è¾“å…¥å¯†ç " clearable prepend-inner-icon="mdi-lock"></v-text-field>
								<v-text-field label="ç¡®è®¤å¯†ç " type="password" v-model="confirmPassword" outlined
									maxlength="20" placeholder="è¯·è¾“å…¥å¯†ç " clearable
									prepend-inner-icon="mdi-lock"></v-text-field>
							</v-card-text>
							<v-card-actions>
								<v-btn color="primary" @click="register" block>æ³¨å†Œ</v-btn>
							</v-card-actions>

						</v-tab-item>
					</v-tabs-items>
				</v-card>
			</v-dialog>




			<!--  -->
			<v-dialog v-model="assistantDialog" max-width="500">
				<v-card>
					<v-tabs v-model="tab">
						<v-tab>è‡ªå®šä¹‰</v-tab>
						<v-tab>è‡ªç”±åˆ›ä½œ</v-tab>

						<v-tab-item>
							<v-card-title>åˆ›å»ºæ–°åŠ©æ‰‹</v-card-title>
							<v-card-text>
								<!-- è‡ªå®šä¹‰é€‰é¡¹å¡å†…å®¹ -->
								<v-text-field label="å§“å" outlined prepend-inner-icon="mdi-account"
									v-model="assistant.name" maxlength="20"></v-text-field>
								<v-text-field label="æè¿°" outlined prepend-inner-icon="mdi-information"
									v-model="assistant.description" maxlength="200"></v-text-field>
								<v-text-field label="åŠŸèƒ½" outlined prepend-inner-icon="mdi-cog"
									v-model="assistant.function" maxlength="200"></v-text-field>
								<v-text-field label="ä¸ªäººä¿¡æ¯" outlined prepend-inner-icon="mdi-account-details"
									v-model="assistant.personalInfo" maxlength="200"></v-text-field>
							</v-card-text>
							<v-card-actions>
								<v-btn color="primary" @click="saveAssistant">åˆ›å»º</v-btn>
								<v-btn @click="closeAssistantDialog">å–æ¶ˆ</v-btn>
							</v-card-actions>
						</v-tab-item>

						<v-tab-item>
							<!-- è‡ªç”±åˆ›ä½œé€‰é¡¹å¡å†…å®¹ -->
							<v-card-title>è‡ªç”±åˆ›ä½œ</v-card-title>
							<v-card-text>
								<!-- è¿™é‡Œæ”¾ç½®è‡ªç”±åˆ›ä½œçš„å†…å®¹ -->
							</v-card-text>
							<v-card-actions>
								<!-- è‡ªç”±åˆ›ä½œé€‰é¡¹å¡çš„æŒ‰é’® -->
							</v-card-actions>
						</v-tab-item>
					</v-tabs>
				</v-card>
			</v-dialog>

			<!--  -->
			<v-app id="inspire">
				<v-system-bar app>
					<v-spacer></v-spacer>
					<v-btn icon @click="showSettingsDialog">
						<!-- è®¾ç½®å›¾æ ‡ -->
						<v-icon>mdi-cog</v-icon>
					</v-btn>

					<!-- åˆ‡æ¢æ—¥å¤œæ¨¡å¼æŒ‰é’® -->
					<v-btn icon @click="toggleDarkMode">
						<v-icon>{{ darkMode ? 'mdi-white-balance-sunny' : 'mdi-brightness-2' }}</v-icon>
					</v-btn>

					<!-- åˆ‡æ¢å¤šè¯­è¨€æ¨¡å‹æŒ‰é’® -->
					<v-btn icon @click="toggleLanguage">
						<v-icon>mdi-translate</v-icon>
					</v-btn>
				</v-system-bar>

				<v-app-bar app clipped-right flat height="72">
					<v-toolbar-title>{{ chatTitle }}</v-toolbar-title>
					<v-spacer></v-spacer>

					<!-- å³ä¾§å›¾æ ‡æŒ‰é’® -->
					<v-icon @click="toggleMood">mdi-emoticon-outline</v-icon>
				</v-app-bar>

				<v-navigation-drawer v-model="drawer" app width="300">
					<v-navigation-drawer v-model="drawer" absolute mini-variant>
						<v-avatar class="d-block text-center mx-auto mt-4" size="36">
							<v-img src="../img/a-lovely-human-being.png" alt="Image description"></v-img>
						</v-avatar>

						<v-divider class="mx-3 my-5"></v-divider>

						<v-btn icon size="28" class="d-block text-center mx-auto mb-9" @click="topage('')">
							<v-tooltip bottom>
								<template v-slot:activator="{ on }">
									<v-icon v-on="on">mdi-chat</v-icon>
								</template>
								<span>èŠå¤©</span>
							</v-tooltip>
						</v-btn>

						<v-btn icon size="28" class="d-block text-center mx-auto mb-9"
							@click="topage('/mind/views/data.html')">
							<v-tooltip bottom>
								<template v-slot:activator="{ on }">
									<v-icon v-on="on">mdi-database</v-icon>
								</template>
								<span>æ•°æ®</span>
							</v-tooltip>
						</v-btn>

						<v-btn icon size="28" class="d-block text-center mx-auto mb-9"
							@click="topage('/mind/views/warning.html')">
							<v-tooltip bottom>
								<template v-slot:activator="{ on }">
									<v-icon v-on="on">mdi-alert</v-icon>
								</template>
								<span>è­¦å‘Š</span>
							</v-tooltip>
						</v-btn>
					</v-navigation-drawer>




					<v-btn color="white" width="100%" elevation="0" class="mx-3 my-3" @click="openAssistantDialog">
						<v-icon left>mdi-robot</v-icon>
						åˆ›å»ºæ–°åŠ©æ‰‹

						<v-icon right>mdi-plus</v-icon>

					</v-btn>
					<v-divider class="mx-3 my-3"></v-divider>
					<v-list class="pl-14" shaped>
						<v-list-item v-for="item in assistants" :key="item.id" link
							:active-class="selectedItem === item ? 'selected-item' : ''" @click="selectItem(item)">
							<v-list-item-content>
								<v-list-item-title>{{ item.name }}</v-list-item-title>
							</v-list-item-content>
						</v-list-item>
					</v-list>
				</v-navigation-drawer>

				<!-- 				<v-navigation-drawer app clipped right>
					<v-list>
						<v-list-item v-for="n in 5" :key="n" link>
							<v-list-item-content>
								<v-list-item-title>Item {{ n }}</v-list-item-title>
							</v-list-item-content>
						</v-list-item>
					</v-list>
				</v-navigation-drawer> -->

				<v-main>
					<!--  -->

					<!-- æ¶ˆæ¯åˆ—è¡¨ -->
					<v-container id="message-list" style="padding-bottom: 60px;overflow-y: auto;">

						<v-row v-for="(message, index) in messages" :key="index">
							<v-col cols="auto">
								<v-avatar size="40">
									<img :src="message.sender === 'robot' ? '../img/a-lovely-robot.png' : '../img/a-lovely-human-being.png'"
										alt="Avatar">
								</v-avatar>
							</v-col>
							<v-col>
								<div>
									<span style="font-weight: bold;">{{ message.sender === 'robot' ? 'å°æµ·' :
					                                                    'ä½ ' }}</span>
									<!-- å¦‚æœæ¶ˆæ¯ä¸º "ç”Ÿäº§ä¸­..."ï¼Œæ˜¾ç¤ºåŠ è½½ä¸­çš„è¿›åº¦åœ† -->
									<v-progress-circular v-if="message.content === 'æ€è€ƒä¸­...'" indeterminate
										color="primary" size="16"></v-progress-circular>
								</div>
								<div>
									<span>{{ message.content }}</span>
								</div>
							</v-col>
						</v-row>
					</v-container>

				</v-main>

				<v-footer app color="white" height="72" inset>
					<v-text-field v-model='newMessage' background-color="grey lighten-3" dense flat hide-details rounded
						solo placeholder="åˆ†äº«ä»Šå¤©çš„å¿ƒæƒ…å§">
						<template v-slot:append>
							<v-btn icon @click="sendMessage">
								<v-icon>mdi-arrow-up</v-icon>
							</v-btn>
						</template>
					</v-text-field>
				</v-footer>
			</v-app>
		</div>
		<style>
			/* æ·»åŠ é¼ æ ‡æ‰‹å‹ */
			.avatar:hover {
				cursor: pointer;
			}

			/* æ·»åŠ é¼ æ ‡ç§»å…¥æ•ˆæœ */
			.avatar:hover {
				background-color: #868686;
				/* æ·¡ç°è‰²èƒŒæ™¯ */
			}

		</style>

		<script>
			new Vue({
				el: '#app',
				vuetify: new Vuetify({
					icons: {
						iconfont: 'mdi', // é»˜è®¤å›¾æ ‡é›†
					},
					theme: {
						dark: false
					}
				}),
				data() {
					return {
						// ä½ çš„æ•°æ®å±æ€§
						chatTitle: "",
						selectedItem: null,
						settingsDialog: false,
						showToast: false,
						errorMessage: 'è´¦å·å¯†ç é”™è¯¯',
						drawer: true,
						url: 'http://127.0.0.1:8080/api',
						userId: 0,
						selectAssistantId: 0,
						darkMode: false,
						language: true, // æ·»åŠ  language å±æ€§
						assistantDialog: false,
						newMessage: "",
						assistants: [],
						assistant: {
							name: '',
							description: '',
							function: '',
							personalInfo: ''
						},
						messages: [{
							sender: 'robot',
							content: 'æ¬¢è¿æ¥åˆ°å¿ƒè†å®ˆæŠ¤ï¼Œ è®©æˆ‘ä»¬ä¸€èµ·æ¥è¿›è¡Œå¿ƒç†æ¢è®¨å’Œäº¤æµå§ã€‚ æˆ‘å¯ä»¥ä¸ºæ‚¨æŸ¥æ‰¾å¿ƒç†çŸ¥è¯†ã€æ·±å…¥åˆ†æå¿ƒç†é—®é¢˜å’Œä¸ºä½ æä¾›å®‰å…¨ä¿æŠ¤ã€‚ğŸ¤—ğŸ¤—ğŸ¤— '
						}],
						loginDialog: false,
						username: "",
						password: "",
						email: "",
						tab: 0,
						newUsername: "",
						newPassword: "",
						confirmPassword: "",
						newEmail: "",
						selectId: 0,
						mood: 'mdi-emoticon-happy-outline', // é»˜è®¤æƒ…æ„Ÿå›¾æ ‡

					};
				},
				mounted() {

					//è®¾ç½® Content-Type 
					axios.defaults.headers.common['Content-Type'] = 'application/json;charset=UTF-8';
					//è®¾ç½® æºå¸¦cookiesï¼Œå¦‚æœæœ‰å®‰å…¨æ¡†æ¶æˆ–è€…SSOå¯¹cookieæ ¡éªŒï¼Œè®¾ç½®æºå¸¦cookies 
					axios.defaults.withCredentials = true;
					// åœ¨é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
					this.checkAuthentication();
					// æ³¨å†Œçƒ­é”®
					window.addEventListener('keydown', this.handleHotkey);

				},
				methods: {
					getCookie(name) {
						// åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡
						const cookieMap = {};
						// è·å–å½“å‰é¡µé¢çš„cookieï¼Œå¹¶ä»¥åˆ†å·ç©ºæ ¼åˆ†å‰²
						const cookies = document.cookie.split("; ");
						// éå†cookieï¼Œå¹¶ä»¥ç­‰å·åˆ†å‰²ï¼Œå­˜å…¥cookieMapä¸­
						cookies.forEach(cookie => {
							const [key, value] = cookie.split("=");
							cookieMap[key] = value;
						});
						// è¿”å›cookieMapä¸­nameå¯¹åº”çš„å€¼
						return cookieMap[name];
					},
					setCookie(name, value, days) {
						// åˆå§‹åŒ–expires
						let expires = "";
						// å¦‚æœä¼ å…¥äº†dayså‚æ•°
						if (days) {
							// åˆ›å»ºä¸€ä¸ªDateå¯¹è±¡
							const date = new Date();
							// è®¾ç½®dateå¯¹è±¡çš„å€¼ï¼ŒåŠ ä¸Šdayså‚æ•°çš„å€¼ï¼Œè½¬æ¢ä¸ºæ¯«ç§’æ•°
							date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
							// è®¾ç½®expiresçš„å€¼ä¸ºåˆ†å·ç©ºæ ¼ï¼ŒåŠ ä¸Šdateå¯¹è±¡è½¬æ¢ä¸ºUTCæ—¶é—´æ ¼å¼
							expires = "; expires=" + date.toUTCString();
						}
						// è®¾ç½®cookieï¼Œå‚æ•°ä¸ºnameï¼Œvalueï¼Œexpires
						document.cookie = name + "=" + (value || "") + expires + "; path=/";
					},
					// æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
					checkAuthentication() {
						if (!this.getCookie("isAuthenticated")) {
							this.openLoginDialog();
						} else {
							this.userId = this.getCookie("user_id")
							this.username = this.getCookie("username")
							axios.get(this.url + '/assistant/listAll?user_id=' + this.userId)
								.then(response => {
									data = response.data
									if (data.code == 200) {
										console.log(response)
										this.assistants = data.data
										this.selectedItem = data.data[0]
										this.selectId = data.data[0].id
										this.chatTitle = data.data[0].name

									}


								})

							// axios.get(this.url+"/message/get_message").then(response=>{
							// })
						}
					},
					showSettingsDialog() {
						this.settingsDialog = true;
					},
					closeSettingsDialog() {
						this.settingsDialog = false;
					},
					saveSettings() {
						// ä¿å­˜è®¾ç½®çš„é€»è¾‘
						console.log('ä¿å­˜è®¾ç½®');
						this.closeSettingsDialog(); // ä¿å­˜åå…³é—­è®¾ç½®çª—ä½“
					},
					// æ‰“å¼€ç™»å½•çª—å£
					openLoginDialog() {
						this.loginDialog = true;
					},
					// å…³é—­ç™»å½•çª—å£
					closeLoginDialog() {
						this.loginDialog = false;
					},
					login() {
						// è¿™é‡Œæ·»åŠ ç™»å½•é€»è¾‘
						if (this.username && this.password) {
							// è°ƒç”¨ç™»å½•æ¥å£æˆ–è€…å…¶ä»–ç™»å½•é€»è¾‘
							axios.post(this.url + "/user/login", {
								username: this.username,
								password: this.password

							}).then(response => {
								data = response.data
								// ç™»å½•æˆåŠŸåå…³é—­å¯¹è¯æ¡†
								if (data.code == 200) {
									data = data.data
									this.setCookie("isAuthenticated", true, 1);
									this.setCookie("user_id", data.id, 1);
									this.userId = data.id
									this.setCookie("username", data.username, 1)
									this.username = data.username;
									this.loginDialog = false;
									this.checkAuthentication();
									// æ¸…ç©ºç™»å½•è¡¨å•å­—æ®µ
									this.password = '';
									// 
								} else {
									console.log(response)
								}

							}).catch(error => {
								this.errorMessage = error.message;
								this.showToast = true;
							});
						} else {
							// æç¤ºç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
							alert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
						}
					},
					register() {
						// è¿™é‡Œæ·»åŠ æ³¨å†Œé€»è¾‘
						if (this.newUsername && this.newPassword && this.confirmPassword) {
							// æ£€æŸ¥å¯†ç æ˜¯å¦åŒ¹é…
							if (this.newPassword !== this.confirmPassword) {
								alert('ç¡®è®¤å¯†ç ä¸åŒ¹é…');
								return;
							}
							// è°ƒç”¨æ³¨å†Œæ¥å£æˆ–è€…å…¶ä»–æ³¨å†Œé€»è¾‘
							// è°ƒç”¨ç™»å½•æ¥å£æˆ–è€…å…¶ä»–ç™»å½•é€»è¾‘
							axios.post(this.url + "/user/register", {
								username: this.newUsername,
								password: this.newPassword,
								email: this.newEmail,

							}).then(response => {
								data = response.data
								// ç™»å½•æˆåŠŸåå…³é—­å¯¹è¯æ¡†
								if (data.code == 200) {

									// æ³¨å†ŒæˆåŠŸååˆ‡æ¢åˆ°tab
									this.tab = 0;
									// æ¸…ç©ºæ³¨å†Œè¡¨å•å­—æ®µ
									this.newUsername = '';
									this.newPassword = '';
									this.confirmPassword = '';
									this.newEmail = '';
									// æ¸…ç©ºç™»å½•è¡¨å•å­—æ®µ
									this.username = '';
									this.password = '';
								} else {
									console.log(response)
								}

							}).catch(error => {
								this.errorMessage = error.message;
								this.showToast = true;
							});

						}
					},
					selectItem(item) {
						this.selectedItem = item;
						console.log(item)
						this.chatTitle = item.name
						this.selectId = item.id
						// æ‰§è¡Œé€‰ä¸­åçš„é€»è¾‘
					},
					toggleLoginDialog() {
						this.loginDialog = !this.loginDialog;
					},
					toggleMood() {
						// æ ¹æ®å½“å‰å¿ƒæƒ…çŠ¶æ€åˆ‡æ¢å›¾æ ‡
						if (this.mood === 'mdi-emoticon-happy-outline') {
							this.mood = 'mdi-emoticon-neutral-outline'; // åˆ‡æ¢åˆ°ä¸€èˆ¬å¿ƒæƒ…å›¾æ ‡
						} else if (this.mood === 'mdi-emoticon-neutral-outline') {
							this.mood = 'mdi-emoticon-sad-outline'; // åˆ‡æ¢åˆ°åå¿ƒæƒ…å›¾æ ‡
						} else {
							this.mood = 'mdi-emoticon-happy-outline'; // åˆ‡æ¢åˆ°å¥½å¿ƒæƒ…å›¾æ ‡
						}
					},
					topage(route) {
						window.open(route, "_self")

					},
					toggleDarkMode() {
						this.darkMode = !this.darkMode;
						// åœ¨è¿™é‡Œå¯ä»¥æ·»åŠ åˆ‡æ¢æ—¥å¤œæ¨¡å¼çš„é€»è¾‘
						this.$vuetify.theme.dark = !this.$vuetify.theme.dark;
					},
					toggleLanguage() {
						this.chinese = !this.chinese;
						// åœ¨è¿™é‡Œå¯ä»¥æ·»åŠ åˆ‡æ¢è¯­è¨€çš„é€»è¾‘
					},
					openAssistantDialog() {
						this.assistantDialog = true;
					},
					closeAssistantDialog() {
						this.assistantDialog = false;
					},
					saveAssistant() {
						// æ£€æŸ¥è¾“å…¥å†…å®¹çš„åˆç†
						if (!this.assistant.name || !this.assistant.description || !this.assistant.function || !this
							.assistant.personalInfo) {
							this.errorMessage = 'è¯·è¾“å…¥å†…å®¹';
							this.showToast = true;
							return;

						} else {

							this.loading = true;
							// åœ¨è¿™é‡Œç¼–å†™ä¿å­˜åŠ©æ‰‹çš„é€»è¾‘
							// å¯ä»¥å‘é€è¯·æ±‚å°†è¾“å…¥æ¡†ä¸­çš„æ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ç­‰
							axios.post(this.url + '/assistant/create', {
									user_id: this.userId,
									name: this.assistant.name,
									description: this.assistant.description,
									function: this.assistant.function,
									user_detail: this.assistant.personalInfo
								})
								.then(response => {
									data = response.data
									if (data.code == 200) {
										this.loading = false;
										this.closeAssistantDialog();
										this.getNewAssistant(this.userId);
									}

								})
						}

						// ä¿å­˜æˆåŠŸåå…³é—­å¯¹è¯æ¡†
					},
					getNewAssistant(user_id) {
						axios.get(this.url + '/assistant/allList?user_id=' + user_id).then(response => {

							data = response.data
							if (data.code = 200) {
								this.assistants = data.data

							}
						})

					},
					sendMessage() {
						// åœ¨å‘é€æ¶ˆæ¯åç«‹å³å°†æ–°æ¶ˆæ¯æ·»åŠ åˆ°æ¶ˆæ¯åˆ—è¡¨ä¸­
						this.messages.push({
							sender: 'human',
							content: this.newMessage
						});

						// åœ¨å‘é€æ¶ˆæ¯åæ˜¾ç¤ºâ€œæ€è€ƒä¸­â€æ¶ˆæ¯
						this.messages.push({
							sender: 'robot',
							content: 'æ€è€ƒä¸­...'
						});
						axios.post(this.url+'/message/insert_message',{
							user_id:this.userId,
							assistant_id:this.selectId,
							content:this.newMessage
						})

						// å‘é€æ¶ˆæ¯ç»™åç«¯å¹¶ç«‹å³æ›´æ–°ç”¨æˆ·ç•Œé¢
						axios.post(this.url + '/assistant/ai/choice', {
							message: this.newMessage
						}, {
							headers: {
								'Content-Type': 'application/x-www-form-urlencoded'
							}
						}).then(response => {
							console.log(response.data.assistant);
							const data = response.data.assistant;
							// æ ¹æ®å“åº”æ›´æ–°ç”¨æˆ·ç•Œé¢
							this.updateUI(data);
						}).catch(error => {
							console.error('Error:', error);
						});

						// æ¸…ç©ºæ–°æ¶ˆæ¯è¾“å…¥æ¡†
						this.newMessage = "";
					},

					updateUI(data) {
						// æ ¹æ®å“åº”æ›´æ–°æ¶ˆæ¯åˆ—è¡¨ä¸­çš„å†…å®¹
						switch (data) {
							case "é€‰é¡¹A":
								this.messages[this.messages.length - 1].content = "åˆå§‹åŒ–å¿ƒç†åŠ©æ‰‹...";
								axios.post(this.url + '/assistant/ai/chat', {
									message: this.newMessage,
									assistant_id: this.selectId
								}, {
									headers: {
										'Content-Type': 'application/x-www-form-urlencoded'
									}
								}).then(response => {
									console.log(response);
									// æ›´æ–°æ¶ˆæ¯åˆ—è¡¨ä¸­çš„å†…å®¹
									this.messages[this.messages.length - 1].content = response;
								});
								break;
							case "é€‰é¡¹B":
								this.messages[this.messages.length - 1].content = "æŸ¥è¯¢å¿ƒç†å­¦çŸ¥è¯†åº“ä¸­...";
								axios.post(this.url + '/assistant/ai/chat', {
									message: this.newMessage,
									assistant_id: this.selectId
								}, {
									headers: {
										'Content-Type': 'application/x-www-form-urlencoded'
									}
								}).then(response => {
									console.log(response);
									// æ›´æ–°æ¶ˆæ¯åˆ—è¡¨ä¸­çš„å†…å®¹
									this.messages[this.messages.length - 1].content = response;
								});
								break;
							case "é€‰é¡¹C":
								this.messages[this.messages.length - 1].content = "æ£€æµ‹åˆ°å±é™©è¨€è®º!";
								this.showToast = true;
								this.errorMessage = "æ£€æµ‹åˆ°ä½ æœ‰å±é™©è¨€è®ºï¼Œå·²ç»å‘ç”Ÿæ¶ˆæ¯åˆ°ç´§æ€¥è”ç³»äºº";
								break;
							default:
								this.messages[this.messages.length - 1].content = "ç”Ÿæˆä¸­...";
								axios.post(this.url + "/assistant/ai/Samplychat", {
									message: this.newMessage,
								}, {
									headers: {
										'Content-Type': 'application/x-www-form-urlencoded'
									}
								}).then(response => {
									// æ›´æ–°æ¶ˆæ¯åˆ—è¡¨ä¸­çš„å†…å®¹
									this.messages[this.messages.length - 1].content = response;
								});
						}
					},

					// çƒ­é”®å¤„ç†å‡½æ•°
					handleHotkey(event) {
						// Enterï¼šå‘é€æ¶ˆæ¯
						if (event.keyCode === 13) {
							// è°ƒç”¨å‘é€æ¶ˆæ¯çš„æ–¹æ³•
							this.sendMessage();
						}
						// ctrl+enteré”®ï¼šæ¢è¡Œ
						if (event.ctrlKey && event.keyCode === 13) {
							// è¾“å…¥æ¡†æ¢è¡Œ


						}
					},
					getStreamData(url) {
						fetch(url)
							.then(response => {
								const reader = response.body.getReader();
								const stream = new ReadableStream({
									start(controller) {
										function push() {
											reader.read().then(({
												done,
												value
											}) => {
												if (done) {
													controller.close();
													return;
												}
												controller.enqueue(value);
												push();
											});
										}
										push();
									}
								});
								return new Response(stream);
							})
							.then(response => {
								const reader = response.body.getReader();
								const decoder = new TextDecoder();

								function read() {
									reader.read().then(({
										done,
										value
									}) => {
										if (done) return;
										console.log(decoder.decode(value, {
											stream: true
										}));
										read();
									});
								}
								read();
							})
							.catch(error => {
								console.error('Error fetching data:', error);
							});

					}
				},
				beforeDestroy() {
					// åœ¨ç»„ä»¶é”€æ¯å‰ç§»é™¤çƒ­é”®ç›‘å¬å™¨
					window.removeEventListener('keydown', this.handleHotkey);
				}

			})
		</script>

	</body>
</html>